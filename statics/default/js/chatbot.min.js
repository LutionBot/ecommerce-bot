!function(){"use strict";var e=function(t,a){if(!(this instanceof e))return new e(t,a);var s={theme:"light",roundedBorders:!0},n=this;a=a||{},t=t||"";for(var c in s)void 0===a[c]&&(a[c]=s[c]);if(n.container=t,n.params=a,n.hasJquery=!1,"#"==t.slice(0,1))n.containerType="id";else{if("."!=t.slice(0,1))return void console.log("Container is invalid");n.containerType="class"}0==n.hasJquery&&(t=t.slice(1,t.length)),n.hasJquery?n.container=$(t):"class"==n.containerType?n.container=document.getElementsByClassName(t)[0]:n.container=document.getElementById(t),n.addClass=function(e,a){return n.hasJquery?e.addClass(a):(n.containerType,e.className+=" "+a),t},n.initBot=function(e){document.getElementsByClassName("lution-spinner")[0].classList.remove("dont-show"),((e=e||window.event).target||e.srcElement).removeEventListener("click",n.initBot,!1);var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4==this.readyState&&200==this.status){document.getElementsByClassName("lution-spinner")[0].classList.add("dont-show");var e=JSON.parse(this.responseText);document.getElementById("chat-input").onkeypress=function(e){13==e.which&&n.chooseSearchType()},n.openChat(),n.companyData=e,n.insertBotMessage(n.companyData.greetingMsg)}},t.open("GET","https://www.lutionbot.com/api/company/tan%20intensa?startChat=true",!0),t.send()},n.chooseSearchType=function(){var e=document.getElementsByClassName("chat-input")[0].value;n.clearInput();var t=n.initSearchFlow(e);"query"==t.searchType||"query"!=t.searchType&&e.split(" ").length>1?n.search(t.searchType,e):(n.insertUserMessage(e),n.insertBotMessage(t.msg),document.getElementById("chat-input").onkeypress=function(e){13==e.which&&n.search(t.searchType)})},n.search=function(e,t){var a;if(t?(a=t,e="fb"):a=document.getElementsByClassName("chat-input")[0].value,1!=a.split(" ").length||-1==a.toLowerCase().indexOf("categoria")&&-1==a.toLowerCase().indexOf("producto")){n.insertUserMessage(a),n.clearInput();var s=new XMLHttpRequest,c=JSON.stringify({company:n.companyData.company,word:a.toLowerCase(),type:e});s.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var t={product:"products",category:"categories",fb:"fb"},a=JSON.parse(this.responseText);if(a.constructor!==Array){if("common"==a.type&&a.word)return n.insertBotMessage(a.word);if("search"==a.type&&a.word)return n.insertBotMessage(n.companyData.startConfig[t[e]].searchMsg+" ",n.answerPrettifier(a))}n.insertBotMessage(n.companyData.startConfig[t[e]].searchMsg+" ",n.answerPrettifier(this.responseText)),document.getElementById("chat-input").onkeypress=function(e){13==e.which&&n.chooseSearchType()}}},s.open("POST","https://www.lutionbot.com/api/text",!0),s.setRequestHeader("Content-Type","application/json;charset=UTF-8"),s.send(c)}else n.chooseSearchType()},n.answerPrettifier=function(e){var t={a:{msg:"",href:""}};try{return e=JSON.parse(e),t.a.msg=e[0].reference,t.a.href=e[0].reference,t}catch(a){return e.constructor!==Array&&e.href?(t.a.msg=e.href,t.a.href=e.href,t):e}},n.initSearchFlow=function(e){return-1!=e.toLowerCase().indexOf("producto")?(n.startConfig=n.companyData.startConfig.products,n.startConfig.type="product"):-1!=e.toLowerCase().indexOf("categoria")?(n.startConfig=n.companyData.startConfig.categories,n.startConfig.type="category"):n.startConfig={msg:"Encontramos los siguientes resultados para lo que estas buscando: "+n.companyData.searchUrl+e.toLowerCase().split(" ").join("+"),type:"query"},{msg:n.startConfig.msg,searchType:n.startConfig.type}},n.clearInput=function(){document.getElementsByClassName("chat-input")[0].value=""},n.openChat=function(e){document.getElementsByClassName("chat-window")[0].classList.remove("dont-show"),((e=e||window.event).target||e.srcElement).removeEventListener("click",n.openChat,!1),document.getElementsByClassName("chat-title")[0].addEventListener("click",n.closeChat,!1),document.getElementsByClassName("chat-title")[0].innerHTML="LutionBot"},n.closeChat=function(e){document.getElementsByClassName("chat-window")[0].classList.add("dont-show"),((e=e||window.event).target||e.srcElement).removeEventListener("click",n.closeChat,!1),document.getElementsByClassName("chat-title")[0].addEventListener("click",n.openChat,!1)},n.insertBotMessage=function(e,t){var a={className:"chat-line bot-line",span:{msg:e}};if(t)for(var s=0;s<Object.keys(t).length;s++)a[Object.keys(t)[s]]=t[Object.keys(t)[s]];n.createDiv(!1,document.getElementsByClassName("chat-box")[0],a),document.getElementsByClassName("chat-box")[0].scrollTop=document.getElementsByClassName("chat-box")[0].scrollHeight},n.insertUserMessage=function(e){n.createDiv(!1,document.getElementsByClassName("chat-box")[0],{className:"chat-line user-line",span:{msg:e}}),document.getElementsByClassName("chat-box")[0].scrollTop=document.getElementsByClassName("chat-box")[0].scrollHeight},n.createDiv=function(e,t,a){var s=document.createElement("div");if(a.className&&(s.className=a.className),a.clickFunction&&(s.addEventListener?s.addEventListener("click",a.clickFunction,!1):s.attachEvent&&s.attachEvent("click",a.clickFunction)),0!=e){var n=document.createTextNode(e);s.appendChild(n)}if(a.span&&a.span.msg){var c=document.createElement("span"),o=document.createTextNode(a.span.msg);c.appendChild(o),s.appendChild(c)}if(a.a&&a.a.msg&&a.a.href){var r=document.createElement("a"),i=document.createTextNode(a.a.msg);r.setAttribute("href",a.a.href),r.setAttribute("target","_blank"),r.appendChild(i),s.appendChild(r)}t.appendChild(s)},n.createInput=function(e,t,a){var s=document.createElement("INPUT");s.setAttribute("type",e),a.className&&s.setAttribute("class",a.className),a.id&&s.setAttribute("id",a.id),a.placeholder&&s.setAttribute("placeholder",a.placeholder),t.appendChild(s)},n.createDiv(!1,n.container,{className:"chat-title",clickFunction:n.initBot,span:{msg:"Iniciar Chat"}}),n.createDiv(!1,n.container,{className:"chat-window dont-show"}),n.createDiv(!1,document.getElementsByClassName("chat-title")[0],{className:"lution-spinner dont-show"}),n.createDiv(!1,document.getElementsByClassName("chat-window")[0],{className:"chat-box"}),n.createDiv(!1,document.getElementsByClassName("chat-window")[0],{className:"chat-clearBoth"}),n.createDiv(!1,document.getElementsByClassName("chat-window")[0],{className:"chat-input-box"}),n.createInput("text",document.getElementsByClassName("chat-input-box")[0],{className:"chat-input",id:"chat-input",placeholder:"Escribe un mensaje"}),0==n.params.roundedBorders&&(document.getElementsByClassName("chat-container")[0]=n.addClass(document.getElementsByClassName("chat-container")[0],"straightBorder")),"light"==n.params.theme&&(document.getElementsByClassName("chat-title")[0]=n.addClass(document.getElementsByClassName("chat-title")[0],"light")),"dark"==n.params.theme&&(document.getElementsByClassName("chat-title")[0]=n.addClass(document.getElementsByClassName("chat-title")[0],"dark"))};window.Lution=e}();var lution=new Lution(".chat-container",{theme:"light",roundedBorders:!1});