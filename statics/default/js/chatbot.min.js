!function(){"use strict";var e=function(t,a){if(!(this instanceof e))return new e(t,a);var n={theme:"light"},s=this;a=a||{},t=t||"";for(var c in n)void 0===a[c]&&(a[c]=n[c]);if(s.container=t,s.params=a,s.hasJquery=!1,"#"==t.slice(0,1))s.containerType="id";else{if("."!=t.slice(0,1))return void console.log("Container is invalid");s.containerType="class"}0==s.hasJquery&&(t=t.slice(1,t.length)),s.hasJquery?s.container=$(t):"class"==s.containerType?s.container=document.getElementsByClassName(t)[0]:s.container=document.getElementById(t),s.addClass=function(e,a){return s.hasJquery?e.addClass(a):(s.containerType,e.className+=" "+a),t},s.initBot=function(e){((e=e||window.event).target||e.srcElement).removeEventListener("click",s.initBot,!1);var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.responseText);document.getElementById("chat-input").onkeypress=function(e){13==e.which&&s.chooseSearchType()},s.openChat(),s.companyData=e,s.insertBotMessage(s.companyData.greetingMsg)}},t.open("GET","https://www.lutionbot.com/api/company/tan%20intensa?startChat=true",!0),t.send()},s.chooseSearchType=function(){var e=document.getElementsByClassName("chat-input")[0].value;s.clearInput();var t=s.initSearchFlow(e);"query"==t.searchType||"query"!=t.searchType&&e.split(" ").length>1?s.search(t.searchType,e):(s.insertUserMessage(e),s.insertBotMessage(t.msg),document.getElementById("chat-input").onkeypress=function(e){13==e.which&&s.search(t.searchType)})},s.search=function(e,t){var a;if(t?(a=t,e="fb"):a=document.getElementsByClassName("chat-input")[0].value,1!=a.split(" ").length||-1==a.toLowerCase().indexOf("categoria")&&-1==a.toLowerCase().indexOf("producto")){s.insertUserMessage(a),s.clearInput();var n=new XMLHttpRequest,c=JSON.stringify({company:s.companyData.company,word:a.toLowerCase(),type:e});n.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var t={product:"products",category:"categories",fb:"fb"};console.log(e),s.insertBotMessage(s.companyData.startConfig[t[e]].searchMsg+" ",s.answerPrettifier(this.responseText)),document.getElementById("chat-input").onkeypress=function(e){13==e.which&&s.chooseSearchType()}}},n.open("POST","https://www.lutionbot.com/api/text",!0),n.setRequestHeader("Content-Type","application/json;charset=UTF-8"),n.send(c)}else s.chooseSearchType()},s.answerPrettifier=function(e){var t={a:{msg:"",href:""}};try{return e=JSON.parse(e),t.a.msg=e[0].reference,t.a.href=e[0].reference,t}catch(t){return e=e}},s.initSearchFlow=function(e){return-1!=e.toLowerCase().indexOf("producto")?(s.startConfig=s.companyData.startConfig.products,s.startConfig.type="product"):-1!=e.toLowerCase().indexOf("categoria")?(s.startConfig=s.companyData.startConfig.categories,s.startConfig.type="category"):s.startConfig={msg:"Encontramos los siguientes resultados para lo que estas buscando: "+s.companyData.searchUrl+e.toLowerCase().split(" ").join("+"),type:"query"},{msg:s.startConfig.msg,searchType:s.startConfig.type}},s.clearInput=function(){document.getElementsByClassName("chat-input")[0].value=""},s.openChat=function(e){document.getElementsByClassName("chat-window")[0].classList.remove("dont-show"),((e=e||window.event).target||e.srcElement).removeEventListener("click",s.openChat,!1),document.getElementsByClassName("chat-title")[0].addEventListener("click",s.closeChat,!1),document.getElementsByClassName("chat-title")[0].innerHTML="LutionBot"},s.closeChat=function(e){document.getElementsByClassName("chat-window")[0].classList.add("dont-show"),((e=e||window.event).target||e.srcElement).removeEventListener("click",s.closeChat,!1),document.getElementsByClassName("chat-title")[0].addEventListener("click",s.openChat,!1)},s.insertBotMessage=function(e,t){var a={className:"chat-line bot-line",span:{msg:e}};if(t)for(var n=0;n<Object.keys(t).length;n++)a[Object.keys(t)[n]]=t[Object.keys(t)[n]];s.createDiv(!1,document.getElementsByClassName("chat-box")[0],a),document.getElementsByClassName("chat-box")[0].scrollTop=document.getElementsByClassName("chat-box")[0].scrollHeight},s.insertUserMessage=function(e){s.createDiv(!1,document.getElementsByClassName("chat-box")[0],{className:"chat-line user-line",span:{msg:e}}),document.getElementsByClassName("chat-box")[0].scrollTop=document.getElementsByClassName("chat-box")[0].scrollHeight},s.createDiv=function(e,t,a){var n=document.createElement("div");if(a.className&&(n.className=a.className),a.clickFunction&&(n.addEventListener?n.addEventListener("click",a.clickFunction,!1):n.attachEvent&&n.attachEvent("click",a.clickFunction)),0!=e){var s=document.createTextNode(e);n.appendChild(s)}if(a.span&&a.span.msg){var c=document.createElement("span"),o=document.createTextNode(a.span.msg);c.appendChild(o),n.appendChild(c)}if(a.a&&a.a.msg&&a.a.href){var i=document.createElement("a"),r=document.createTextNode(a.a.msg);i.setAttribute("href",a.a.href),i.appendChild(r),n.appendChild(i)}t.appendChild(n)},s.createInput=function(e,t,a){var n=document.createElement("INPUT");n.setAttribute("type",e),a.className&&n.setAttribute("class",a.className),a.id&&n.setAttribute("id",a.id),t.appendChild(n)},s.createDiv("Hola amigos",s.container,{className:"chat-title",clickFunction:s.initBot}),s.createDiv(!1,s.container,{className:"chat-window dont-show"}),s.createDiv(!1,document.getElementsByClassName("chat-window")[0],{className:"chat-box"}),s.createDiv(!1,document.getElementsByClassName("chat-window")[0],{className:"chat-clearBoth"}),s.createDiv(!1,document.getElementsByClassName("chat-window")[0],{className:"chat-input-box"}),s.createInput("text",document.getElementsByClassName("chat-input-box")[0],{className:"chat-input",id:"chat-input"}),"light"==s.params.theme&&(document.getElementsByClassName("chat-title")[0]=s.addClass(document.getElementsByClassName("chat-title")[0],"light")),"dark"==s.params.theme&&(document.getElementsByClassName("chat-title")[0]=s.addClass(document.getElementsByClassName("chat-title")[0],"dark"))};window.Lution=e}();var lution=new Lution(".chat-container",{theme:"dark"});